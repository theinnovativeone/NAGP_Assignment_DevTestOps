pipeline{
	agent any
	tools{
		maven 'Maven3'
	}
	triggers{
		cron('0 06 * * *')
	}
	stages{
		stage("Code Checkout"){
			steps{
				bat "echo hello"
			}
		}
		stage("Code Build"){
			steps{
				bat "mvn clean"
			}
		}
		stage("unit test"){
			steps{
				bat "mvn test"
			}
		}
		stage('SonarQube Analysis') {
			steps{
				echo 'Starting SonarQube Analysis!'
      				withSonarQubeEnv('Test_SonarQube_Jenkins'){
        				bat 'mvn clean verify sonar:sonar'
   					echo 'SonarQube Analysis Completed' 
      				}
			}
		}
		stage("Publish to artifactory"){
			steps{
				echo 'Uploading binaries to the artifactory!'
				rtMavenDeployer(
					id: 'deployer',
					serverId: 'JFrogArt_test',
					releaseRepo: 'NAGP_Pipeline_Project',
					snapshotRepo: 'NAGP_Pipeline_Project'
				)
				rtMavenRun(
					pom: 'pom.xml',
					goals: 'clean install',
					deployerId: 'deployer'
				)
				rtPublishBuildInfo(
					serverId: 'JFrogArt_test'
				)
				echo 'All the binaries are uploaded!'
			}
		}
	}
	post {
        	always {
			echo 'Sending mail regarding pipeline build results!'
            		emailext body: 'Test Message',
    			subject: 'Pipeline build results',
    			to: 'guptasneha2099@gmail.com'        
		}
    	}
}
